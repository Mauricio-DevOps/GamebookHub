@model IEnumerable<GamebookHub.Models.GameNode>
@{
    var gb = ViewBag.Gamebook as GamebookHub.Models.Gamebook;
    ViewData["Title"] = $"Nós - {gb?.Title}";
    Layout = "/Areas/Admin/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-nodes-index.css" asp-append-version="true" />
}

<!-- PAGE HEADER -->
<div class="gb-nodes-header">
    <div class="container-xxl">
        <div class="gb-header-top">
            <a class="btn btn-secondary btn-sm" 
               asp-area="Admin" asp-controller="Gamebooks" asp-action="Index">
                <i class="bi bi-arrow-left"></i>
                Voltar aos Gamebooks
            </a>
        </div>
        <div class="gb-header-content">
            <div>
                <h1 class="mb-2">
                    <i class="bi bi-diagram-3"></i>
                    Nós do Gamebook
                </h1>
                <p >
                    <strong>@gb?.Title</strong> · Gerenciando os pontos de decisão da história
                </p>
            </div>
            <div>
                <a class="btn btn-primary btn-lg"
                   asp-area="Admin" asp-controller="Nodes" asp-action="Create"
                   asp-route-gamebookId="@gb!.Id">
                    <i class="bi bi-plus-circle"></i>
                    Novo Nó
                </a>
            </div>
        </div>
    </div>
</div>

<!-- NODES LIST -->
<div class="container-xxl">
    <div class="gb-nodes-content">
        @{
            var nodes = Model.ToList();
        }

        @if (nodes.Count == 0)
        {
            <div class="gb-empty-state">
                <div class="gb-empty-icon">
                    <i class="bi bi-inbox"></i>
                </div>
                <h3>Nenhum Nó Encontrado</h3>
                <p>Comece criando seu primeiro nó para estruturar a história.</p>
                <a class="btn btn-primary mt-3"
                   asp-area="Admin" asp-controller="Nodes" asp-action="Create"
                   asp-route-gamebookId="@gb!.Id">
                    <i class="bi bi-plus-circle"></i>
                    Criar Primeiro Nó
                </a>
            </div>
        }
        else
        {
            <!-- NODES TABLE -->
            <div class="gb-table-card">
                <div class="gb-table-header">
                    <div class="gb-table-title">
                        <i class="bi bi-list-ul"></i>
                        Listagem de Nós (@nodes.Count)
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="gb-table">
                        <thead>
                            <tr>
                                <th style="width: 80px;">
                                    <i class="bi bi-hash"></i>
                                    ID
                                </th>
                                <th>
                                    <i class="bi bi-key"></i>
                                    Key
                                </th>
                                <th style="width: 120px;">
                                    <i class="bi bi-flag"></i>
                                    Encerramento
                                </th>
                                <th style="width: 350px;" class="text-end">
                                    <i class="bi bi-gear"></i>
                                    Ações
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var n in nodes)
                            {
                                <tr>
                                    <td>
                                        <span class="badge bg-secondary">@n.Id</span>
                                    </td>
                                    <td>
                                        <code class="gb-code">@n.Key</code>
                                    </td>
                                    <td>
                                        @if (n.IsEnding)
                                        {
                                            <span class="badge bg-danger">
                                                <i class="bi bi-stop-circle-fill"></i>
                                                Fim
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-info">
                                                <i class="bi bi-arrow-right-circle"></i>
                                                Continuação
                                            </span>
                                        }
                                    </td>
                                    <td class="text-end">
                                        <div class="gb-row-actions">
                                            <a class="btn btn-action btn-action-choices"
                                               asp-area="Admin" asp-controller="Choices" asp-action="Index"
                                               asp-route-fromNodeId="@n.Id"
                                               title="Gerenciar Escolhas">
                                                <i class="bi bi-diagram-2"></i>
                                                <span>Escolhas</span>
                                            </a>
                                            <a class="btn btn-action btn-action-edit"
                                               asp-area="Admin" asp-controller="Nodes" asp-action="Edit" asp-route-id="@n.Id"
                                               title="Editar Nó">
                                                <i class="bi bi-pencil"></i>
                                                <span>Editar</span>
                                            </a>
                                            <a class="btn btn-action btn-action-delete"
                                               asp-area="Admin" asp-controller="Nodes" asp-action="Delete" asp-route-id="@n.Id"
                                               title="Excluir Nó"
                                               onclick="return confirm('Tem certeza que deseja excluir este nó?');">
                                                <i class="bi bi-trash"></i>
                                                <span>Excluir</span>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="gb-table-footer">
                    <small class="text-muted">
                        <i class="bi bi-info-circle"></i>
                        Total de @nodes.Count nó(s) · Clique em "Escolhas" para gerenciar as decisões de cada nó
                    </small>
                </div>
            </div>
        }
    </div>
</div>
